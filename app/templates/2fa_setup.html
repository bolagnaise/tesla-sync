{% extends "base.html" %}

{% block content %}
    <h1>Setup Two-Factor Authentication</h1>

    <article>
        <h3>Step 1: Scan QR Code</h3>
        <p>Open your authenticator app (Google Authenticator, Authy, etc.) and scan this QR code:</p>

        <div style="text-align: center; margin: 1.5em 0;">
            <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code for 2FA Setup" style="max-width: 250px; border: 1px solid var(--pico-muted-border-color); padding: 10px; background: white;">
        </div>

        <details>
            <summary>Can't scan? Enter code manually</summary>
            <p>Enter this secret key in your authenticator app:</p>
            <code style="word-break: break-all; font-size: 1.1em;">{{ totp_secret }}</code>
        </details>
    </article>

    <article>
        <h3>Step 2: Verify Code</h3>
        <p>Enter the 6-digit code from your authenticator app to complete setup:</p>

        <form action="" method="post" novalidate>
            {{ form.hidden_tag() }}

            <label for="token">
                {{ form.token.label }}
                {{ form.token(size=6, maxlength=6, autocomplete="one-time-code", inputmode="numeric", pattern="[0-9]*", style="text-align: center; font-size: 1.5em; letter-spacing: 0.3em; max-width: 200px;") }}
                {% for error in form.token.errors %}
                <small style="color: red;">{{ error }}</small>
                {% endfor %}
            </label>

            {{ form.submit() }}
        </form>
    </article>

    <p><a href="{{ url_for('main.settings') }}">Cancel and return to Settings</a></p>
{% endblock %}
